## iPattern

### Installation

To request the iPattern package, please contact the corresponding author Dr. Stephen W. Scherer (stephen.scherer@sickkids.ca) of the [paper](https://www.ncbi.nlm.nih.gov/pubmed/20531469). For more information about iPattern, please refer to the [paper](https://www.ncbi.nlm.nih.gov/pubmed/?term=21552272).

After obtaining the package (e.g., ipn.0.581.tar.gz is the version we received), please follow the instructions in the iPattern tutorial enclosed in the package for installation and usage. Here we echo the installation instructions in their tutorial. 

#### Requirements
- R (2.7.1+)
- The R ppc package – it can be downloaded from http://www-stat.stanford.edu/~tibs/PPC/Rdist/index.html
- Python (2.5.5+)

#### Setup

- untar the package file with `tar -zvxf ipn.0.581.tar.gz`
- setup environment:
  - set up environment variable IPNBASE: `export IPNBASE='/path/to/ipn_0.581'`
  - set up environment variable PYTHONPATH: `PYTHONPATH=$PYTHONPATH:'/path/to/ipn_0.581/ipnlib'`

Note: the directory structure/name must be kept as it is. Changing the directory structure will break the iPattern pipeline, the pipeline finds all the necessary scripts based on IPNBASE and the directory structure. When PBS job submitting system is not available, you can use `–-noqsub` option to run iPattern sequentially.

Remark:

- 

- hg19

- batch

### Analysis workflow

#### Prepare auxiliary input files

In addition to the sample-wise final report files in `${WKDIR}/01_initial_call/run_iPattern/data`, which are supposed to have been generated by `${WKDIR}/01_initial_call/prepare_IPQ_input_file/finalreport_to_iPattern.pl`, three other auxiliary input files for iPattern can be generated as follows.

```sh
PROJECT_NAME=<project_name>
Rscript ${WKDIR}/01_initial_call/run_iPattern/prepare_input_files_for_iPattern.R ${WKDIR} ${PROJECT_NAME}
```

When the processing is completed, three files are supposed to be generated at  `${WKDIR}/01_initial_call/run_iPattern/data_aux`

- `${PROJECT_NAME}_data_file.txt`: lists the absolute path to all the sample-wise final report files in `${WKDIR}/01_initial_call/run_iPattern/data`, so that iPattern knows where to find these data files.

- `${PROJECT_NAME}_gender_file.txt`: tab-delimited table including two columns (without column names in table header): Sample ID and Gender ("M" for male and "F" for female), which is generated based on `${WKDIR}/data/Samples_Table.txt` (see the detailed decription of [data](https://github.com/HaoKeLab/ensembleCNV#data)).

- `${PROJECT_NAME}_bad_samples.txt`: lists sample IDs of poor quality to be excluded from iPattern analysis. We prepared an empty file where the users can type in sample IDs of poor quality if there is any.

#### Run iPattern

```sh
${IPNBASE}/ipn_0.581/preprocess/ilmn/ilmn_run.py \
--data-file-list   ${WKDIR}/01_initial_call/run_iPattern/data_aux/${PROJECT_NAME}_data_file.txt \
--gender-file      ${WKDIR}/01_initial_call/run_iPattern/data_aux/${PROJECT_NAME}_gender_file.txt \
--bad-sample-file  ${WKDIR}/01_initial_call/run_iPattern/data_aux/${PROJECT_NAME}_bad_samples.txt \
--experiment       $PROJECT_NAME \
--output-directory ${WKDIR}/01_initial_call/run_iPattern/results/ \
--do-log
--do-cleanup
--noqsub
```

When the analysis is completed, you will find two files (among others) in the directory `${WKDIR}/01_initial_call/run_iPattern/results`:
- `${PROJECT_NAME}_all_calls.txt`:
- `${PROJECT_NAME}_sample.stats.txt`:

These two files will be used by ensembleCNV.
